import{r as u}from"./index-CJ_LmFaV.js";import{i as ue}from"./isBrowser-C2N6XvuH.js";var D=(e=>(e.Day="D",e.Month="M",e.Year="Y",e.Hours="h",e.Minutes="m",e.Seconds="s",e))(D||{});const E={Date:"date",DateTime:"date-time"},T={FullTime:"full-time",NoSeconds:"no-seconds"},H="date-time-no-sec",te={[E.Date]:{"ru-RU":"ДД.ММ.ГГГГ","en-US":"DD.MM.YYYY"},[E.DateTime]:{"ru-RU":"ДД.ММ.ГГГГ, чч:мм:сс","en-US":"DD.MM.YYYY, hh:mm:ss"},[H]:{"ru-RU":"ДД.ММ.ГГГГ, чч:мм","en-US":"DD.MM.YYYY, hh:mm"},[T.FullTime]:{"ru-RU":"чч:мм:сс","en-US":"hh:mm:ss"},[T.NoSeconds]:{"ru-RU":"чч:мм","en-US":"hh:mm"}},W=new Intl.Locale("ru-RU"),X={D:{start:0,end:2,max:31,min:1},M:{start:3,end:5,max:12,min:1},Y:{start:6,end:10,max:2100,min:1900}},$=(e,t)=>({h:{start:e,end:e+2,max:23,min:0},m:{start:e+3,end:e+5,max:59,min:0},...t?{s:{start:e+6,end:e+8,max:59,min:0}}:{}}),h={[E.Date]:X,[E.DateTime]:{...X,...$(12,!0)},[H]:{...X,...$(12,!1)},[T.FullTime]:$(0,!0),[T.NoSeconds]:$(0,!1)},B={[E.Date]:["D","M","Y"],[E.DateTime]:["D","M","Y","h","m","s"],[H]:["D","M","Y","h","m"],[T.FullTime]:["h","m","s"],[T.NoSeconds]:["h","m"]},Z={D:"ДД",M:"ММ",Y:"ГГГГ"},G={h:"чч",m:"мм",s:"сс"},K={D:"DD",M:"MM",Y:"YYYY"},q={h:"hh",m:"mm",s:"ss"},re={[E.Date]:{"ru-RU":Z,"en-US":K},[E.DateTime]:{"ru-RU":{...Z,...G},"en-US":{...K,...q}},[H]:{"ru-RU":{...Z,...G,s:void 0},"en-US":{...K,...q,s:void 0}},[T.FullTime]:{"ru-RU":G,"en-US":q},[T.NoSeconds]:{"ru-RU":{...G,s:void 0},"en-US":{...q,s:void 0}}};function oe(e){return t=>{if(t!==null){for(const r in h[e])if(t>=h[e][r].start&&t<=h[e][r].end)return r}}}function le(e){const t=B[e];return r=>{const m=t.length-1,c=t[m],i=t.indexOf(r);return i===-1||i===m?c:t[i+1]}}function ie(e){const t=B[e];return r=>{const c=t[0],i=t.indexOf(r);return i===-1||i===0?c:t[i-1]}}const p=new Date;function De(e){if(!e)return;const t=e.split(", "),r=t[0];let m=t[1],[c,i,v]=r.split(".").map(Number);if(i-=1,r.includes(":")&&(m=r),m){(isNaN(v)||isNaN(i)||isNaN(c))&&(v=p.getFullYear(),i=p.getMonth(),c=p.getDay());const[d=0,b=0,k=0]=m.split(":").map(f=>Number(f??0));return new Date(v,i,c,d,b,k)}return new Date(v,i,c)}function me({inputRef:e,mode:t}){const r=u.useCallback(s=>{if(e.current){const{start:o,end:a}=h[t][s];e.current.setSelectionRange(o,a)}},[t,e]),m=u.useCallback(()=>{var s,o,a;return((s=e.current)==null?void 0:s.value.length)===((o=e.current)==null?void 0:o.selectionEnd)&&((a=e.current)==null?void 0:a.selectionStart)===0},[e]),c=u.useCallback(s=>e.current?e.current.value.slice(h[t][s].start,h[t][s].end):"",[t,e]),i=u.useCallback(()=>e.current?Object.keys(h[t]).every(s=>c(s)&&Number.isInteger(Number(c(s)))):!1,[t,c,e]),v=u.useCallback(()=>{if(Object.values(T).includes(t))return!0;const o=parseInt(c(D.Day),10),a=parseInt(c(D.Month),10),S=parseInt(c(D.Year),10);return!a||!o?!0:new Date(S||2020,a-1,o).getDate()===o},[c,t]),d=u.useCallback(()=>{var w;let s;const o=Object.keys(h[t]).reduce((g,z)=>{const P=z;return g[P]=parseInt(c(P),10),g},{}),{[D.Day]:a,[D.Month]:S,[D.Year]:Y,[D.Hours]:x,[D.Minutes]:F,[D.Seconds]:C}=o,N=h[t][D.Year],A=!!(a&&S&&Y>=(N==null?void 0:N.min)&&Y<=(N==null?void 0:N.max)),M=[x,F,...t===E.DateTime||t===T.FullTime?[C]:[]].every(g=>g!==void 0);if(t===E.DateTime||t===H?s=A&&M:t===T.FullTime||t===T.NoSeconds?s=M:s=A,s&&e.current){const g=(w=e.current)==null?void 0:w.value.length;e.current.selectionStart=g,e.current.selectionEnd=g}return s},[c,e,t]),b=u.useCallback((s,o)=>{if(e.current){const{start:a,end:S,max:Y}=h[t][s];e.current.value=e.current.value.slice(0,a)+o.toString().padStart(Y.toString().length,"0")+e.current.value.slice(S),r(s)}},[e,r,t]),k=u.useMemo(()=>le(t),[t]),f=u.useMemo(()=>ie(t),[t]),L=u.useMemo(()=>oe(t),[t]),I=u.useCallback(s=>{const o=De(s);return o&&(t===T.FullTime||t===T.NoSeconds)?{hours:o.getHours(),minutes:o.getMinutes(),seconds:o.getSeconds()}:o},[t]);return{isAllSelected:m,isValidInput:v,tryToCompleteInput:d,getSlot:c,updateSlot:b,setFocus:r,isLikeDate:i,getNextSlotKey:k,getPrevSlotKey:f,getSlotKeyFromIndex:L,parseDate:I}}function Te({inputRef:e,onChange:t,readonly:r,locale:m=W,setIsOpen:c,mode:i,showSeconds:v}){var R;const d=i===E.DateTime&&!v?H:i,b=h[d],k=te[d][m.baseName]||te[d][W.baseName],f=re[d][m.baseName]||re[d][W.baseName],L=B[d],{getNextSlotKey:I,getPrevSlotKey:s,getSlotKeyFromIndex:o,setFocus:a,updateSlot:S,getSlot:Y,isLikeDate:x,isAllSelected:F,tryToCompleteInput:C,isValidInput:N,parseDate:A}=me({inputRef:e,mode:d}),M=u.useMemo(()=>L[0],[L]),w=u.useRef(M),g=u.useCallback(n=>{if(!e.current||r)return;if(ue()&&document.activeElement!==e.current){w.current=n||M,e.current.focus();return}const V=n||w.current;if(x()&&V===M)return;if(!e.current.value){e.current.value=k,a(M);return}if(n!=="auto"){a(V);return}const l=o(e.current.selectionStart);if(l){const{start:j,end:O}=b[l];e.current.setSelectionRange(j,O)}},[e,r,x,M,o,k,a,b]),z=u.useCallback(()=>{g("auto")},[g]),P=()=>{var n;t&&x()&&t(A(((n=e.current)==null?void 0:n.value)||""))},y=u.useCallback(n=>{if(!(n===L[L.length-1]&&C())){if(N()){a(I(n));return}switch(n){case D.Day:S(D.Month,(f==null?void 0:f[D.Month])??""),a(D.Month);return;case D.Year:case D.Month:S(D.Day,(f==null?void 0:f[D.Day])??""),a(D.Day);return;default:a(I(n))}}},[L,C,N,a,I,S,f]),ne=u.useCallback(n=>{if(e.current&&!r){if(n.key!=="Tab"&&(n.preventDefault(),n.stopPropagation()),n.key!=="ArrowDown"&&c(!1),n.key==="Escape"){e.current.blur();return}n.key==="Enter"&&C();const V=e.current.selectionStart,l=o(V);if(l){const j=Y(l),{max:O,min:J}=b[l],ce=Number(j)||0;if(n.key==="ArrowRight"){if(F()||l===L[L.length-1]){e.current.selectionStart=e.current.value.length;return}a(I(l));return}if(n.key==="ArrowLeft"){a(s(l));return}if(n.key==="Backspace"&&(F()?(e.current.value=k,a(M)):S(l,f[l]??"")),/^\d+$/.test(n.key)){const U=Number(n.key),_=parseInt(ce.toString()+n.key,10)||0,ee=_.toString().length,Q=O.toString().length,ae=j.match(/^0+$/)&&Q===2&&U===0;ee<Q?((_||_>=J)&&(S(l,_),ae&&y(l)),_*10>O&&y(l)):ee>Q?U*10>O?(S(l,n.key),y(l)):(U||U>=J)&&S(l,n.key):_<=O?(S(l,_),y(l)):U*10>O?(S(l,n.key),y(l)):(U||U>=J)&&S(l,n.key)}t==null||t(A(x()?e.current.value:""))}}},[e,r,o,c,C,Y,b,A,x,t,F,L,a,I,s,k,M,S,f,y]),se=u.useCallback(()=>{var n;!r&&((n=e.current)==null?void 0:n.value)===k&&(e.current.value=""),w.current=M},[e,k,r,M]);return{handleKeyDown:ne,handleChange:P,handleClick:z,setInputFocus:g,value:(R=e.current)==null?void 0:R.value,mask:k,handleBlur:se}}function fe({onFocusByKeyboard:e,onFocusByClick:t}){const r=u.useRef(!1),m=u.useRef(!1),c=u.useCallback(d=>{r.current=!0,m.current?(t==null||t(d),m.current=!1):e==null||e(d)},[m,t,e]),i=u.useCallback(()=>{r.current=!1,m.current=!1},[]),v=u.useCallback(()=>{r.current||(m.current=!0)},[r]);return{onFocus:c,onBlur:i,onMouseDown:v}}function Me(e){return u.useCallback(t=>{e.forEach(r=>r==null?void 0:r(t))},[e])}export{W as D,D as S,T,Me as a,fe as b,Te as u};
